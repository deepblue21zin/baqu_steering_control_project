# 아두이노 서보 제어 - 배선 가이드

## 🔌 단계별 배선

---

## Level 1: 기본 테스트 (LED만)

### 목적
- 펄스 생성 확인
- 코드 업로드 테스트
- 시리얼 통신 확인

### 부품
- Arduino Uno × 1
- LED × 2 (빨강, 초록)
- 저항 220Ω × 2
- 점퍼 와이어

### 배선도

```
        Arduino Uno
    ┌─────────────────┐
    │                 │
D2 ─┤                 │
    │                 │     LED1 (빨강)
    │    ┌────────┐   │      ┌──▷|──┐
    │    │  ATmega│   │  →   │      │
    │    │  328P  │   │     220Ω    │
    │    │        │   │      │      │
D3 ─┤    │        │   │     GND    GND
    │    │        │   │
    │    └────────┘   │     LED2 (초록)
D13─┤ (내장 LED)     │      ┌──▷|──┐
    │                 │  →   │      │
    │                 │     220Ω    │
GND─┤                 │      │      │
    │                 │     GND    GND
USB─┤                 │
    └─────────────────┘
```

### 연결
```
Arduino D2  → 저항 220Ω → LED1 (+) → GND
Arduino D3  → 저항 220Ω → LED2 (+) → GND
Arduino GND → 공통 GND
```

### 테스트
```
1. 업로드
2. LED 깜빡임 확인
3. 시리얼 모니터에서 "demo" 입력
4. LED 패턴 변화 확인
```

---

## Level 2: 엔코더 테스트

### 목적
- 엔코더 읽기 확인
- 카운트 증감 확인
- 방향 감지 확인

### 추가 부품
- 로터리 엔코더 모듈 (또는 서보 엔코더)
- 점퍼 와이어

### 배선도

```
Arduino          로터리 엔코더
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5V         →     VCC (또는 +)
GND        →     GND
D4         →     A (CLK)
D5         →     B (DT)
```

### 엔코더 종류별 연결

**일반 로터리 엔코더:**
```
┌─────────────┐
│   ●  ●  ●   │  ← 핀
│   │  │  │   │
│  GND A  B   │
└─────────────┘

A → D4
B → D5
GND → GND
```

**서보 엔코더 (L7):**
```
⚠️ 주의: 24V 차동 신호!
→ 레벨 변환 필요
→ 일단 시뮬레이션만

나중에 추가:
AO/BO → 라인리시버 → 5V → Arduino
```

### 테스트
```
1. 업로드
2. 시리얼 모니터 열기
3. 엔코더 회전
4. 카운트 변화 확인
   - 시계방향: 증가
   - 반시계방향: 감소
```

---

## Level 3: 완전 시스템 (실제 서보)

### 목적
- 실제 서보모터 제어
- 위치 제어 테스트
- 전체 시스템 검증

### 추가 부품
- L7 서보 드라이브 + 모터
- 24V 전원 (5A 이상)
- 릴레이 모듈 5V × 4개
- 라인드라이버 IC (SN75176) × 2
- 라인리시버 IC (SN75176) × 2
- 점퍼 와이어 다수

### 전체 배선도

```
┌─────────────────────────────────────────────────┐
│                  전체 시스템                    │
└─────────────────────────────────────────────────┘

        ┌───────────┐
        │ Arduino   │
        │   Uno     │
        └───────────┘
             │
    ┌────────┴────────┐
    │                 │
펄스 출력          엔코더 입력
    │                 │
    ↓                 ↓
┌─────────┐      ┌─────────┐
│릴레이 × 2│      │라인리시버│
│(24V 변환)│      │(5V 변환)│
└────┬────┘      └────┬────┘
     │                │
     ↓                ↓
┌──────────────────────────┐
│    L7 서보 드라이브      │
│                          │
│  PF+/PF- (펄스)          │
│  AO/BO (엔코더)          │
│  SVON, EMG (제어)        │
└────────┬─────────────────┘
         ↓
    ┌─────────┐
    │ 서보모터│
    └─────────┘
```

### 상세 배선

**1. 펄스 출력 (Arduino → 서보)**

```
Arduino D2 → Relay1 IN (5V 코일)
            Relay1 VCC ← 5V (Arduino)
            Relay1 GND ← GND
            Relay1 COM ← 24V (외부)
            Relay1 NO  → L7 Pin 8 (PF+)

Arduino D3 → Relay2 IN
            Relay2 VCC ← 5V
            Relay2 GND ← GND
            Relay2 COM ← 24V
            Relay2 NO  → L7 Pin 9 (PR+)

L7 Pin 10 (PF-) → GND (공통)
L7 Pin 11 (PR-) → GND (공통)
```

**2. 제어 신호 (Arduino → 서보)**

```
Arduino D6 → Relay3 IN
            Relay3 COM ← 24V
            Relay3 NO  → L7 Pin 47 (SVON)

Arduino D7 → Relay4 IN
            Relay4 COM ← 24V
            Relay4 NO  → L7 Pin 18 (EMG)
```

**3. 엔코더 입력 (서보 → Arduino)**

```
⚠️ 중요: 라인리시버 필요!

L7 Pin 32 (AO)  ─┬─→ SN75176 A
L7 Pin 33 (/AO) ─┘   SN75176 B
                     SN75176 RO → Arduino D4

L7 Pin 30 (BO)  ─┬─→ SN75176 A
L7 Pin 31 (/BO) ─┘   SN75176 B
                     SN75176 RO → Arduino D5

SN75176 설정:
- VCC: 5V
- GND: GND (공통)
- /RE: GND (수신 활성화)
- DE: GND (송신 비활성화)
```

**4. 전원**

```
24V 전원:
- (+) → L7 U, V, W (모터 전원)
- (+) → 릴레이 COM
- (-) → GND (공통)

5V 전원 (Arduino):
- USB 또는 외부 5V
- Arduino 5V → 릴레이 VCC
- Arduino GND → GND (공통)

⚠️ 중요: 모든 GND를 공통 연결!
```

### 안전 주의사항

```
❌ 절대 금지:
- Arduino에 24V 직접 연결
- GND 분리
- 극성 바꿔 연결
- 전원 켠 상태에서 배선 변경

✅ 반드시:
- 전원 끄고 배선
- 극성 두 번 확인
- GND 공통 연결
- 릴레이로 절연
- 라인리시버로 레벨 변환
```

---

## 🔍 배선 체크리스트

### 배선 전

```
☐ 모든 전원 OFF
☐ 부품 확인
☐ 배선도 출력
☐ 멀티미터 준비
```

### 배선 중

```
☐ 하나씩 천천히
☐ 색깔별 정리 (빨강=전원, 검정=GND 등)
☐ 각 연결마다 사진 촬영
☐ 배선도에 체크
```

### 배선 후

```
☐ 육안 확인
☐ 멀티미터로 전압 확인
  - Arduino: 5V
  - 서보: 24V
  - GND 연결 확인
☐ 단락 없는지 확인
☐ 릴레이 동작 확인 (클릭 소리)
```

### 첫 전원 ON

```
1. Arduino만 USB 연결
2. LED 깜빡임 확인
3. 24V 연결
4. 릴레이 클릭 소리 확인
5. 서보 READY LED 확인
```

---

## 🐛 배선 트러블슈팅

### 문제: Arduino 작동 안함

```
확인:
☐ USB 케이블 연결
☐ 전원 LED 켜짐?
☐ 다른 USB 포트 시도
☐ 다른 케이블 시도
```

### 문제: 릴레이 클릭 안함

```
확인:
☐ 릴레이 VCC = 5V
☐ 릴레이 GND 연결
☐ IN 핀 연결 확인
☐ Arduino 핀 출력 확인
```

### 문제: 서보 안 움직임

```
확인:
☐ 24V 전원 공급
☐ SVON = HIGH (릴레이 ON)
☐ READY LED 켜짐?
☐ ALARM LED 꺼짐?
☐ 펄스 파형 확인 (오실로스코프)
```

### 문제: 엔코더 카운트 안됨

```
확인:
☐ A, B 연결 확인
☐ 라인리시버 전원 (5V)
☐ 엔코더 신호 확인
☐ 코드에서 update() 호출?
```

---

## 📸 배선 사진 예시

```
각 단계별 사진 촬영 추천:

1. 전체 전경
2. Arduino 부분 클로즈업
3. 릴레이 연결부
4. 서보 커넥터
5. 전원 연결부
6. GND 공통점

→ 나중에 트러블슈팅 시 유용!
```

---

## 🎯 배선 완료 후

```
1. 전체 체크리스트 확인
2. 사진 정리
3. 배선도에 실제 색깔 표시
4. 테스트 시작!
```

**안전하고 즐거운 제작 되세요! ⚡**
